# Redis 应用实践

## 分布式锁

- 注意点
    - 原子加锁 set nx px
    - 超时时间设置 避免删除锁得不到执行导致死锁
    - 业务逻辑避免时间过长导致超时 ==> 释放锁其它线程得到执行
    - 可重入锁 ==> ThreadLocal
    - 锁冲突
        - 业务中断结束
        - 重试机制,等待指定间隔时间再重新获取锁
        - 请求转移至延迟队列
- 实现
    - redLock
    - redission

## 布隆过滤器
&emsp;&emsp;布隆过滤器可以理解为一个不怎么精确的 set 结构，当你使用它的 contains 方法判断某个对象是否存在时，它可能会误判。但是布隆过滤器也不是特别不精确，只要参数设置的合理，它的精确度可以控制的相对足够精确，只会有小小的误判概率.<br>
&emsp;&emsp;当布隆过滤器说某个值存在时，这个值可能不存在；当它说不存在时，那就肯定不存在.

- 原理-rebloom模块
    - 多次哈希 ==> Bitmap维护落点位置 ==> 0 和 1
    - 如果有一个落点位为0则不存在,否则可能存在

- 注意点
    - 允许误差

## 限流

- 注意点
    - 滑动窗口算法
        - zset score存储时间撮
        - 删除指定时间内zset中的数据
        - 统计zset中总量是否达到临界值
        - 并发量大的情况下 接口限流过多导致占用内存很大 ==> 不适合限流量大的操作
    - 漏斗限流: redis-cell模块
        - 初始容量大小
        - 维护时间撮
        - 待处理容量
        - 处理速率
        - 过程
            - 请求进来计算时间差*速率=可以处理的数量
            - 数量大于0 ==> 接受请出去 ==> 更新时间撮和待处理容量


## 延时队列

- 注意点
    - List rpop lpop rpush lpush
    - blpop brpop 当队列为空阻塞等待
    - 空闲连接自动断开 ==> 异常捕获处理

## 基数统计法 HyperLogLog
&emsp;&emsp;基数统计数适用于对精度要求允许误差,进行大批量数据统计的业务场景, 对比传统的线程统计在性能和内存占用上有着明显的优势.

- 视频/文章/网页的浏览量


## 高可用机制

主从、哨兵、集群

## 事物管理

## 持久化机制

## 管道命令

## 发布/订阅

## 虚拟内存使用
