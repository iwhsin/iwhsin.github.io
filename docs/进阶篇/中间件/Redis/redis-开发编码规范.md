# Redis 开发规范

## 命名规范

### Key 名设计

- 建议：
  1. 可读性和可管理性
     - 以业务名(或数据库名)为前缀(防止 key 冲突)，用冒号分隔，比如业务名:表名:id
  2. 简洁性
     - 保证语义的前提下，控制 key 的长度，当 key 较多时，内存占用也不容忽视，例如：user:{uid}:friends:messages:{mid} 可简化为 u:{uid}:fr:m:{mid}
  3. 不要包含特殊字符：
     - 空格、换行、单双引号以及其他转义字符。

### Value 设计
- 建议
   - 禁止使用 bigkey(防止网卡流量、慢查询)
      - String 类型控制在 10KB 以内，hash、list、set、zset 元素个数不要超过5000
      - 非字符串的 bigkey，不要使用 del 删除，使用 hscan、sscan、zscan 方式渐进式删除，同时要注意防止 bigkey 过期时间自动删除问题(例如一个 200 万的zset 设置 1 小时过期，会触发 del 操作，造成阻塞，而且该操作不会不出现在慢查询中)
   - 选择适合的数据类型，数据结构优先采用 hash
      - 由于小的 Hash 类型数据占用的空间相对较少，因此我们在实际应用时应该尽可能的考虑使用 Hash 类型，省内存的原因是新建一个 hash 对象时开始是用ziplist 来存储，如果 field 或者 value 的大小超出一定限制后，redis 会在内部自动将 ziplist 替换成正常的 hash 实现
   - 控制 key 的生命周期，控制内存增长

## 安全规范

### 指令安全

&emsp;&emsp;对于类似`keys`、`flushdb`、`flushall`等会对 Redis 的稳定或数据安全造成严重影响的指令,通常可以通过`rename`指定别名或者直接置空禁用的方式避免危险指令的执行.

### 端口安全

&emsp;&emsp;对于客户端的连接可以通过 ip 白名单配置的方式限制客户端的非法连接.

### 脚本安全

&emsp;&emsp;避免 Lua 脚本由用户输入的内容 (UGC) 生成，这可能会被黑客利用以植入恶意的攻击代码来得到 Redis 的主机权限.

### 安全配置

- 限制 Redis 以普通用户的身份启动,避免系统高级权限用户被获取.
- 配置密码认证,避免弱口令的使用
- 使用 SSL 代理避免客户端和服务器之间的交互数据暴露在公网.