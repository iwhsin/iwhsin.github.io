# 数据库专题

## 索引

索引其实是一种数据结构，能够帮助我们快速的检索数据库中的数据。


### 索引的数据结构

- 平衡二叉树
    - 二分法平衡 VAL ==> 复杂度和树的深度成反比
- B树 多路平衡二叉树 ==> M路径
- B+ 树 : 非叶子节点不存储数据 --> 索引指向对应的叶子节点

- Hash索引
    - 哈希表是一种以 key-value 存储数据的结构，所以多个数据在存储关系上是完全没有任何顺序关系的，所以，对于区间查询是无法直接通过索引查询的，就需要全表扫描
    - 哈希索引只适用于等值查询的场景
- B+ Tree
    - InnoDB 默认B+Tree
    - B+ Tree 是一种多路平衡查询树，所以他的节点是天然有序的（左子节点小于父节点、父节点小于右子节点），所以对于范围查询的时候不需要做全表扫描

?> <i class='icon-brand-tripadvisor'></i>
哈希索引适合等值查询，但是不无法进行范围查询 
哈希索引没办法利用索引完成排序 哈希索引不支持多列联合索引的最左匹配规则 如
果有大量重复键值得情况下，哈希索引的效率会很低，因为存在哈希碰撞问题

### 聚簇索引、覆盖索引
- 聚集索引和非聚集索引的根本区别是表中记录的物理顺序和索引的排列顺序是否一致
- B+ Tree 的叶子节点都可以存哪些东西吗
    - InnoDB 的 B+ Tree 可能存储的是整行数据，也有可能是主键的值
        - 聚簇索引: 主键索引(一级索引) ==> 存储整行值 ==> 不需要回表即可查出所有数据
        - 非聚簇索引: 存储主键的值(二级索引) ==> 回表查询主键对应行的数据
            - 覆盖索引: 满足覆盖索引条件的查询也不需要回表即可查询出完整数据
### 索引下推、查询优化
- 联合索引 ==> 最左匹配原则
- 索引下推 ==> 减少回表 ==> 5.6引入

### 索引失效

- 查询优化器(执行计划/路径)
    - 根据搜索条件，找出所有可能使用的索引 
    - 计算全表扫描的代价 
    - 计算使用不同索引执行查询的代价 
    - 对比各种执行方案的代价，找出成本最低的那一个

### explain 查询索引执行计划
[explain](https://www.cnblogs.com/tufujie/p/9413852.html)
- id、select_type、table、type、possible_keys、key、key_len、ref、rows、Extra
    - type
    - key
    - key_len
    - rows
    - extra

MyISAM vs InnoDB

 Mysql 数据库中，最常用的两种引擎是 innordb 和 myisam。InnoDB 是 Mysql 的默认存储引擎。
1.事务处理上方面：
MyISAM 强调的是性能，查询的速度比 InnoDB 类型更快，但是不提供事务支持。InnoDB 提供事务支持事务。
2.外键：MyISAM 不支持外键，InnoDB 支持外键。
3.锁方面的介绍：
MyISAM 只支持表级锁，InnoDB 支持行级锁和表级锁，默认是行级锁，行锁大幅度提高了多用户并发操作的性
能。innodb 比较适合于插入和更新操作比较多的情况，而 myisam 则适合用于频繁查询的情况。另外，InnoDB
表的行锁也不是绝对的，如果在执行一个 SQL 语句时，MySQL 不能确定要扫描的范围，InnoDB 表同样会锁全
表，例如 update table set num=1 where name like “%aaa%”。
4.全文索引：
MyISAM 支持全文索引， InnoDB 不支持全文索引。innodb 从 mysql5.6 版本开始提供对全文索引的支持。
5.表主键的区别：
MyISAM：允许没有主键的表存在。
InnoDB：如果没有设定主键，就会自动生成一个 6 字节的主键(用户不可见)。
6.表的具体行数问题：
MyISAM：select count() from table,MyISAM 只要简单的读出保存好的行数。因为MyISAM 内置了一个计数器，
count()时它直接从计数器中读。
InnoDB：不保存表的具体行数，也就是说，执行 select count(*) from table 时，InnoDB要扫描一遍整个表来计
算有多少行。
一张表,里面有 ID 自增主键,当 insert 了 17 条记录之后,删除了第 15,16,17 条记录,再把 Mysql 重启,再 insert 一
条记录,这条记录的 ID 是 18 还是 15 ？
如果表的类型是 MyISAM， 那么是 18。因为 MyISAM 表会把自增主键的最大 ID 记录到数据文件里， 重启MySQL
自增主键的最大 ID 也不会丢失。
如果表的类型是 InnoDB， 那么是 15。InnoDB 表只是把自增主键的最大 ID 记录到内存中， 所以重启数据库会导
致最大 ID 丢失。